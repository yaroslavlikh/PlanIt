# PlanIt - Telegram бот для управления задачами

Telegram-бот для управления задачами с поддержкой голосового ввода и интеллектуальной обработки текста через LLM.

## Возможности

- ✅ Создание задач через текстовые и голосовые сообщения
- ✅ Автоматическое извлечение информации из естественного языка (название, даты, время, описание)
- ✅ Просмотр всех задач пользователя
- ✅ Хранение данных в SQLite базе данных
- ✅ Поддержка русского языка

## Технологии

- **Python 3.13+**
- **pyTelegramBotAPI** - для работы с Telegram Bot API
- **SQLite** - для хранения задач
- **faster-whisper** - для распознавания голосовых сообщений
- **Ollama** (Qwen2.5) - для обработки естественного языка
- **python-dotenv** - для управления конфигурацией

## Установка

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd PlanIt
```

### 2. Установка зависимостей

```bash
pip install pyTelegramBotAPI faster-whisper python-dotenv requests
```

### 3. Настройка Ollama

Убедитесь, что у вас установлен и запущен Ollama с моделью Qwen2.5:

```bash
# Установка Ollama (если еще не установлен)
# См. https://ollama.ai/

# Загрузка модели Qwen2.5
ollama pull qwen2.5

# Запуск Ollama сервера (обычно запускается автоматически)
ollama serve
```

Ollama должен быть доступен по адресу `http://localhost:11434`

### 4. Настройка окружения

Создайте файл `.env` в корневой директории проекта:

```env
BOT_TOKEN=your_telegram_bot_token_here
```

Для получения токена бота:
1. Откройте [@BotFather](https://t.me/botfather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Скопируйте полученный токен в файл `.env`

## Запуск

```bash
python main.py
```

При успешном запуске вы увидите сообщение:
```
Бот запустился...
```

## Использование

### Команды бота

- `/start` - Запуск бота и отображение главного меню

### Основные функции

1. **Создание новой задачи**
   - Нажмите кнопку "Новая задача"
   - Введите информацию о задаче в свободной форме (текстом или голосовым сообщением)
   - Примеры:
     - "Встреча с командой завтра в 15:00, продолжительность 1 час"
     - "Позвонить маме 25 декабря в 18:00"
     - "Купить продукты, описание: молоко, хлеб, яйца"

2. **Просмотр всех задач**
   - Нажмите кнопку "Все задачи"
   - Получите список всех ваших задач с указанием названия, времени начала, времени окончания и описания (если указано)

## Структура проекта

```
PlanIt/
├── api/
│   ├── __init__.py
│   ├── llm.py          # Интеграция с Ollama/Qwen2.5
│   └── whisper.py      # Обработка голосовых сообщений
├── handlers/
│   ├── __init__.py
│   └── handlers.py     # Обработчики команд бота
├── config.py           # Конфигурация (загрузка токена)
├── db.py               # Инициализация базы данных
├── main.py             # Точка входа приложения
├── .env                # Переменные окружения (не в git)
├── tasks.sql           # SQLite база данных (создается автоматически)
└── README.md           # Документация
```

## База данных

База данных SQLite (`tasks.sql`) создается автоматически при первом запуске. Структура таблицы `tasks`:

- `id` - Уникальный идентификатор задачи
- `user_id` - ID пользователя Telegram
- `title` - Название задачи (обязательное поле)
- `start_time` - Дата и время начала
- `end_time` - Дата и время окончания
- `description` - Описание задачи

## Примечания

- Бот использует локальный сервер Ollama, убедитесь что он запущен перед использованием
- Голосовые сообщения обрабатываются через faster-whisper (модель "small")
- Для лучшей производительности рекомендуется использовать GPU для Whisper (измените `device="cpu"` на `device="cuda"` в `api/whisper.py`)
- База данных хранится локально в файле `tasks.sql`

## Автор

Лихачев Ярослав
